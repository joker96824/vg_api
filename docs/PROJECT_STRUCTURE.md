# 项目结构说明

## 目录结构

```
.
├── alembic/                # 数据库迁移相关文件
├── config/                 # 配置文件目录
├── docs/                   # 项目文档
├── logs/                   # 日志文件目录
├── scripts/               # 脚本文件目录
├── src/                   # 源代码目录
│   ├── api/              # API层
│   │   └── v1/          # API版本1
│   │       ├── endpoints/  # 路由处理器
│   │       └── schemas/    # API请求/响应模型（已迁移到core/schemas）
│   ├── core/             # 核心功能
│   │   ├── auth/         # 认证相关
│   │   ├── config/       # 核心配置
│   │   ├── models/       # 数据库模型
│   │   ├── schemas/      # 数据模型定义
│   │   ├── services/     # 业务服务
│   │   └── utils/        # 工具函数
│   ├── templates/        # 模板文件
│   └── main.py           # 应用入口
├── tests/                # 测试文件目录
├── .editorconfig         # 编辑器配置
├── .gitignore           # Git忽略文件
├── README.md            # 项目说明文档
├── requirements.txt     # 项目依赖
└── setup.py            # 项目安装配置
```

## 文件说明

### 配置文件
- `config/` - 存放所有配置文件
  - `settings.py` - 主配置文件
  - `database.py` - 数据库配置

### 源代码
- `src/` - 主要源代码目录
  - `main.py` - FastAPI应用入口
  - `api/` - API层
    - `v1/endpoints/` - API路由处理器
  - `core/` - 核心功能
    - `auth/` - 认证相关功能
    - `config/` - 核心配置
    - `models/` - SQLAlchemy数据库模型
    - `schemas/` - Pydantic数据模型定义
    - `services/` - 业务服务层
    - `utils/` - 工具函数（所有通用工具函数统一放在这里）
  - `templates/` - 模板文件

### 数据库
- `alembic/` - 数据库迁移相关文件
  - `versions/` - 迁移版本文件
  - `env.py` - 迁移环境配置
  - `script.py.mako` - 迁移脚本模板

### 测试
- `tests/` - 测试文件目录（所有测试文件统一放在这里）
  - `conftest.py` - 测试配置
  - `test_*.py` - 测试文件

### 文档
- `docs/` - 项目文档
  - `PROJECT_STRUCTURE.md` - 项目结构说明（本文档）

### 脚本
- `scripts/` - 脚本文件目录（所有脚本文件统一放在这里）
  - `import_test_data.py` - 测试数据导入脚本
  - `check_tables.py` - 数据库表检查脚本

### 日志
- `logs/` - 日志文件目录
- `app.log` - 应用日志文件

## 文件命名规范

1. Python文件使用小写字母，单词间用下划线连接
2. 类名使用大驼峰命名法
3. 函数和变量使用小写字母，单词间用下划线连接
4. 常量使用大写字母，单词间用下划线连接

## 目录使用规范

1. `api/v1/endpoints/` - 存放所有API路由处理器
2. `core/schemas/` - 存放所有数据模型定义
3. `core/models/` - 存放所有数据库模型
4. `core/services/` - 存放所有业务服务
5. `core/utils/` - 存放所有通用工具函数
6. `scripts/` - 存放所有脚本文件
7. `tests/` - 存放所有测试文件

## 新增文件规范

1. 新增API端点：
   - 在`src/api/v1/endpoints/`下创建对应的路由文件
   - 在`src/core/schemas/`下创建对应的请求/响应模型

2. 新增服务：
   - 在`src/core/services/`下创建对应的服务文件
   - 在`src/core/schemas/`下创建对应的数据模型

3. 新增数据库模型：
   - 在`src/core/models/`下创建对应的模型文件
   - 使用Alembic创建数据库迁移

4. 新增工具函数：
   - 在`src/core/utils/`下创建对应的工具文件
   - 确保工具函数是通用的，不包含业务逻辑

5. 新增测试：
   - 在`tests/`下创建对应的测试文件
   - 遵循`test_*.py`的命名规范

6. 新增脚本：
   - 在`scripts/`下创建对应的脚本文件
   - 确保脚本文件有清晰的用途说明

## 变更记录

| 日期 | 变更内容 | 变更原因 | 执行人 |
|------|----------|----------|--------|
| 2024-03-21 | 将API请求/响应模型从`api/v1/schemas/`迁移到`core/schemas/` | 统一模型管理，提高复用性 | Claude |
| 2024-03-21 | 统一工具函数、脚本和测试文件的位置 | 规范化项目结构，避免重复 | Claude |

## 工作流程

### 新增功能工作流程

1. 查阅文档
   - 首先阅读`PROJECT_STRUCTURE.md`文档
   - 确认新功能应该放在哪个目录
   - 检查是否需要创建新的目录

2. 创建文件
   - 按照文档规范创建新文件
   - 遵循命名规范
   - 确保文件位置正确

3. 更新文档
   - 如果新增了目录，更新目录结构
   - 如果新增了文件类型，更新文件说明
   - 在变更记录中添加新的记录

4. 提交代码
   - 确保新文件符合项目结构
   - 提交代码时包含文档更新

### 修改现有功能工作流程

1. 查阅文档
   - 确认要修改的文件位置
   - 了解相关的依赖关系

2. 进行修改
   - 遵循现有的代码风格
   - 保持目录结构不变

3. 更新文档
   - 如果修改涉及结构变化，更新文档
   - 在变更记录中添加新的记录

### 文档维护

1. 定期检查
   - 每周检查文档是否与实际结构一致
   - 确保所有变更都已记录

2. 版本控制
   - 文档变更需要单独提交
   - 提交信息需要说明文档变更原因

3. 团队协作
   - 所有团队成员都需要了解文档内容
   - 新成员加入时需要先阅读文档

## 注意事项

1. 禁止直接创建新文件而不更新文档
2. 禁止在文档未指定的位置创建文件
3. 禁止修改已删除的目录或文件
4. 所有结构变更必须记录在变更记录中
5. 文档更新必须与代码变更同步进行
6. 所有工具函数必须放在`src/core/utils/`目录下
7. 所有脚本文件必须放在`scripts/`目录下
8. 所有测试文件必须放在`tests/`目录下
9. 环境变量变更时，禁止直接修改代码中的配置值，必须提出要求由管理员添加到`.env`文件中

## 注意事项

1. 禁止直接创建新文件而不更新文档
2. 禁止在文档未指定的位置创建文件
3. 禁止修改已删除的目录或文件
4. 所有结构变更必须记录在变更记录中
5. 文档更新必须与代码变更同步进行
6. 所有工具函数必须放在`src/core/utils/`目录下
7. 所有脚本文件必须放在`scripts/`目录下
8. 所有测试文件必须放在`tests/`目录下 